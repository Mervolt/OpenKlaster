<!DOCTYPE html>
<html lang="pl">
   <head>
      <link rel="stylesheet" href="slideshow.css">
      <link rel="stylesheet" href="aa.css">
      <meta charset="UTF-8">
      <title>Title</title>
      <script src="d3.min.js"></script>
      <script src="config.js"></script>
      <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous">
   </head>
   <body style="overflow: hidden; margin:0;">
      <div class="slideshow-container">
	     <object id="intro" class="slide" style="width:100%;height:100vh;" data="intro/index.html"></object>
         <object id="trees" class="slide" style="width:100%;height:100vh;" data="trees/index.html"></object>
         <div class="slide">
            <div class="row"  style="min-height: 100vh;     background-color: #3e3e3e;
               color: #dcdcdc;">
               <div class="col-md-3">
                  <div class="h-100 d-inline-block" style="width: 100%; background-color: rgba(16, 12, 18, 0.7)">
                     <div class="infocard2">
                        <div class="row no-gutters align-items-center h-100 text-white">
                           <div class="col mr-2">
                              <div class="h5 mb-1">AKTUALNA MOC (W)</div>
                              <div class="h5 mb-0 font-weight-bold text-gray-800">1012</div>
                           </div>
                        </div>
                     </div>
                     <div class="infocard2">
                        <div class="row no-gutters align-items-center h-100 text-white">
                           <div class="col mr-2">
                              <div class="h5  mb-1">WYPRODUKOWANA ENERGIA (kWh)</div>
                              <div class="h5  mb-1">W CIĄGU OSTATNICH 24H</div>
                              <div class="h5 mb-0 font-weight-bold text-gray-800">650.54</div>
                           </div>
                        </div>
                     </div>
                     <div class="infocard2">
                        <div class="row no-gutters align-items-center h-100 text-white">
                           <div class="col mr-2">
                              <div class="h5  mb-1">WYPRODUKOWANA ENERGIA (MWh)</div>
                              <div class="h5 mb-0 font-weight-bold text-gray-800">32</div>
                           </div>
                        </div>
                     </div>
                     <div class="infocard2">
                        <div class="row no-gutters align-items-center h-100 text-white">
                           <div class="col mr-2">
                              <div class="h5  mb-1">OGRANICZONA EMISJA CO2 (t)</div>
                              <div class="h5 mb-0 font-weight-bold text-gray-800">22.3</div>
                           </div>
                        </div>
                     </div>
                     <div class="logo" style="vertical-align: bottom">
                        <img src="logo.png" style="width: 100%">
                        <img src="OpenKlaster.png" style="width: 100%">
                     </div>
                  </div>
               </div>
               <div  class="col-xl-8 col-md-9 mb-4">
                  <div class="h2 text-white font-weight-bold mb-1" style="text-align: center; margin-top: 25px;">Moc w ciągu ostatnich 24 godzin</div>
                  <div class="vertical-center" id="chart"></div>
               </div>
            </div>
         </div>
      </div>
      <br>
      <script>
         var power = 1023;
         var total_energy = 1234.5;
         var co2_avoidance = 123;
         document.getElementById("intro").data = "intro/index.html?power=" + power + "&total_energy=" + total_energy + "&co2_avoidance=" + co2_avoidance;
         function getMockData() {
         	let data = []
         	let parseDate = d3.timeParse('%Y-%m-%dT%H:%M:%S.%L%Z')
         	data.push({timestamp: parseDate('2020-06-01T17:25:34.399Z'), value: 12.5})
         	data.push({timestamp: parseDate('2020-06-01T17:36:34.399Z'), value: 156.5})
         	data.push({timestamp: parseDate('2020-06-01T17:42:34.399Z'), value: 32.5})
         	data.push({timestamp: parseDate('2020-06-01T17:48:34.399Z'), value: 66.5})
         	data.push({timestamp: parseDate('2020-06-01T16:52:34.399Z'), value: 200.5})
         	data.push({timestamp: parseDate('2020-06-01T15:52:34.399Z'), value: 270.5})
         	data.push({timestamp: parseDate('2020-06-01T14:52:34.399Z'), value: 300.5})
         	data.push({timestamp: parseDate('2020-06-01T13:52:34.399Z'), value: 350.5})
         	data.push({timestamp: parseDate('2020-06-01T12:52:34.399Z'), value: 370.5})
         	data.push({timestamp: parseDate('2020-06-01T11:52:34.399Z'), value: 400.5})
         	data.push({timestamp: parseDate('2020-06-01T10:52:34.399Z'), value: 360.5})
         	data.push({timestamp: parseDate('2020-06-01T09:52:34.399Z'), value: 310.5})
         	data.push({timestamp: parseDate('2020-06-01T08:52:34.399Z'), value: 250.5})
         	data.push({timestamp: parseDate('2020-06-01T07:52:34.399Z'), value: 180.5})
         	data.push({timestamp: parseDate('2020-06-01T06:52:34.399Z'), value: 140.5})
         	data.push({timestamp: parseDate('2020-06-01T05:52:34.399Z'), value: 120.5})
         	data.sort((a, b) => {
         		return a.timestamp < b.timestamp ? -1 : 1
         	})
         	return data
         }
         var myJSON = JSON.stringify(getMockData());
         //document.getElementById("power").data = "power/index.html?measurements=" + myJSON;
         //console.log("power/index.html?measurements=" + myJSON);
      </script>
      <script>
         function promilOfWidth(promil) {
             return window.innerWidth * (promil / 1000);
         }
         
         function promilOfHeight(promil) {
             return window.innerHeight * (promil / 1000);
         }
         
         const margin = {
         top: promilOfHeight(10), right: promilOfWidth(300),
         bottom: promilOfHeight(50), left: promilOfWidth(0)
         };
         const width = window.innerWidth - margin.left - margin.right;
         const height = window.innerHeight - margin.top - margin.bottom;
         
         const powerConsumptionTitle = config['textTitles']['powerConsumptionTitle']
         const powerProductionTitle = config['textTitles']['powerProductionTitle']
         
         const svg = d3
             .select('#chart')
             .append('svg')
             .attr('width', width + margin.left + margin.right)
             .attr('height', height + margin.top + margin.bottom)
         
         function draw(data, fillColor, strokeColor, chartTitle, strokeWidth = '1.5') {
             console.log(data)
             const xScale = d3.scaleTime()
                 .domain([earliestDate(data), latestDate(data)])
                 .range([0, width]);
         
             const yScale = d3
                 .scaleLinear()
                 .domain([0, maxValue(data)])
                 .range([height, 0]);
         
             svg.append('g')
                 .attr('class', 'axis')
                 .attr('id', 'xAxis')
                 .attr('transform', `translate(0, ${height})`)
                 .call(d3.axisBottom(xScale));
         
             svg.append('g')
                 .attr('class', 'axis')
                 .attr('id', 'yAxis')
                 .attr('transform', `translate(${width}, 0)`)
                 .call(d3.axisRight(yScale));
         
             const line = d3.area()
                 .x(d => {
                     return xScale(d['timestamp']);
                 })
                 .y0(yScale(0))
                 .y1(d => {
                     return yScale(d['value']);
                 });
         
             svg.append('path')
                 .datum(data)
                 .attr('id', 'priceChart')
                 .attr("fill", fillColor)
                 .attr("stroke", strokeColor)
                 .attr('stroke-width', strokeWidth)
                 .attr('d', line);
         }
         
         function maxValue(data) {
             return d3.max(data, d => {
                 return d['value']
             })
         }
         
         function latestDate(data) {
             return d3.max(data, d => {
                 return d['timestamp']
             })
         }
         
         function earliestDate(data) {
             return d3.min(data, d => {
                 return d['timestamp']
             })
         }
         
         function parseDateToString(date) {
             let parser = d3.timeFormat('%Y-%m-%d_%H:%M:%S')
             return parser(date);
         }
         
         function main(config) {
             (function () {
                 createChart(config);
                 setTimeout(arguments.callee, 60000);
             })();
         }
         
         async function createChart(config) {
             const rootUrl = config['api']['rootUrl'];
             const powerProductionUrl = rootUrl + config['api']['powerProduction'];
             const powerConsumptionUrl = rootUrl + config['api']['powerConsumption'];
             const installationId = config['installationId'];
             const apiToken = config['apiToken'];
         
             const now = new Date()
             const h = 7
         
             now.setTime(now.getTime() + (h * 60 * 60 * 1000))
             const prevDay = new Date();
         
             svg.selectAll("*").remove();
         
             prevDay.setDate(now.getDate() - 1);
         
             const fillColor = config['colours']['fillColor']
             const strokeColor = config['colours']['strokeColor']
         
             draw(getMockData2(), fillColor, strokeColor, powerProductionTitle)
         }
         
         async function drawAsync(url, deviceId, deviceKey, now, prevDay, apiToken, fillColor, strokeColor) {
             const sendUrl = new URL(url);
             const params = {
                 receiverId: deviceId,
                 startDate: parseDateToString(prevDay),
                 endDate: parseDateToString(now),
                 apiToken: apiToken
             };
         
         
             Object.keys(params).forEach(key => sendUrl.searchParams.append(key, params[key]))
             fetch(sendUrl, {
                 method: 'get',
                 headers: {
                     'Content-Type': 'application/json',
                     'Access-Control-Allow-Origin': '*'
                 }
             }).then(response => response.json())
                 .then(data => {
                     let output = []
                     for (const measurement of data) {
                         let parseDate = d3.timeParse('%Y-%m-%dT%H:%M:%S.%L%Z')
                         output.push({timestamp: parseDate(measurement.timestamp), value: measurement.value})
                     }
         
                     output.sort((a, b) => {
                         return a.timestamp < b.timestamp ? -1 : 1
                     })
                     draw(output, fillColor, strokeColor)
                 })
         }
         
         function getMockData() {
             let data = []
             let parseDate = d3.timeParse('%Y-%m-%dT%H:%M:%S.%L%Z')
             data.push({timestamp: parseDate('2020-06-01T17:25:34.399Z'), value: 12.5})
             data.push({timestamp: parseDate('2020-06-01T17:36:34.399Z'), value: 156.5})
             data.push({timestamp: parseDate('2020-06-01T17:42:34.399Z'), value: 32.5})
             data.push({timestamp: parseDate('2020-06-01T17:48:34.399Z'), value: 66.5})
             data.push({timestamp: parseDate('2020-06-01T16:52:34.399Z'), value: 200.5})
             data.push({timestamp: parseDate('2020-06-01T15:52:34.399Z'), value: 270.5})
             data.push({timestamp: parseDate('2020-06-01T14:52:34.399Z'), value: 300.5})
             data.push({timestamp: parseDate('2020-06-01T13:52:34.399Z'), value: 350.5})
             data.push({timestamp: parseDate('2020-06-01T12:52:34.399Z'), value: 370.5})
             data.push({timestamp: parseDate('2020-06-01T11:52:34.399Z'), value: 400.5})
             data.push({timestamp: parseDate('2020-06-01T10:52:34.399Z'), value: 360.5})
             data.push({timestamp: parseDate('2020-06-01T09:52:34.399Z'), value: 310.5})
             data.push({timestamp: parseDate('2020-06-01T08:52:34.399Z'), value: 250.5})
             data.push({timestamp: parseDate('2020-06-01T07:52:34.399Z'), value: 180.5})
             data.push({timestamp: parseDate('2020-06-01T06:52:34.399Z'), value: 140.5})
             data.push({timestamp: parseDate('2020-06-01T05:52:34.399Z'), value: 120.5})
             data.sort((a, b) => {
                 return a.timestamp < b.timestamp ? -1 : 1
             })
             return data
         }
         
         function getMockData2() {
             let data = []
             let parseDate = d3.timeParse('%Y-%m-%dT%H:%M:%S.%L%Z')
             data.push({timestamp: parseDate('2020-06-01T17:20:34.399Z'), value: 35.5})
             data.push({timestamp: parseDate('2020-06-01T17:30:34.399Z'), value: 116.5})
             data.push({timestamp: parseDate('2020-06-01T17:49:34.399Z'), value: 322.5})
             data.push({timestamp: parseDate('2020-06-01T17:40:34.399Z'), value: 69.5})
             data.push({timestamp: parseDate('2020-06-01T16:59:34.399Z'), value: 405.5})
             data.push({timestamp: parseDate('2020-06-01T15:50:34.399Z'), value: 200.5})
             data.push({timestamp: parseDate('2020-06-01T14:50:34.399Z'), value: 250.5})
             data.push({timestamp: parseDate('2020-06-01T13:56:34.399Z'), value: 200.5})
             data.push({timestamp: parseDate('2020-06-01T12:32:34.399Z'), value: 150.5})
             data.push({timestamp: parseDate('2020-06-01T11:25:34.399Z'), value: 100.5})
             data.push({timestamp: parseDate('2020-06-01T10:45:34.399Z'), value: 150.5})
             data.push({timestamp: parseDate('2020-06-01T09:11:34.399Z'), value: 230.5})
             data.push({timestamp: parseDate('2020-06-01T08:03:34.399Z'), value: 270.5})
             data.push({timestamp: parseDate('2020-06-01T07:16:34.399Z'), value: 560.5})
             data.push({timestamp: parseDate('2020-06-01T06:24:34.399Z'), value: 700.5})
             data.push({timestamp: parseDate('2020-06-01T05:11:34.399Z'), value: 135.5})
             data.sort((a, b) => {
                 return a.timestamp < b.timestamp ? -1 : 1
             })
             return data
         }
         
         main(config)
         
      </script>
      <script src="slideshow.js"></script>
      <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
      <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
      <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js" integrity="sha384-B4gt1jrGC7Jh4AgTPSdUtOBvfO8shuf57BaghqFfPlYxofvL8/KUEfYiJOMMV+rV" crossorigin="anonymous"></script>
   </body>
</html>
